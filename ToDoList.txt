# Linux_Maint_ToolKit — Roadmap

This is the single backlog source of truth.

## Working style
- Keep changes small, test-backed, and documented.
- Preserve output contracts; version them when needed.
- Prefer safe defaults and clear operator guidance.
- Offline/dark-site support remains a core constraint.

## Priorities
- **P0**: correctness, reliability, determinism
- **P1**: operator UX and documentation
- **P2**: security and hardening
- **P3**: observability and integrations
- **P4**: DX/release polish

---

## P0 — Correctness / reliability

### P0.3 Fix wrapper skip gating to actually skip monitors (DONE 2026-02-19)
**Why**: current skip logic emits SKIP but still runs the monitor, causing contradictory results.
**Scope**:
- In `run_full_health_monitor.sh`, ensure `skip_monitor` exits the monitor execution path.
- Replace deprecated `host=all` with `host=runner` for wrapper-level skips.
**Acceptance**:
- Tests verify skipped monitors do not execute and only emit a single SKIP line.

### P0.4 Fix `linux-maint diff` debug output ordering (DONE 2026-02-19)
**Why**: debug output currently prints `diff_cur` before it is assigned.
**Scope**:
- Assign `CUR_SUMMARY` before printing debug lines in `bin/linux-maint`.
**Acceptance**:
- Debug output shows correct paths.

### P0.5 Make `summary_contract` temp dir robust in restricted environments (DONE 2026-02-19)
**Why**: CI/sandbox runs can fail writing to repo-local temp dirs.
**Scope**:
- If `LM_TEST_TMPDIR` is not writable, fall back to a user-writable tmp (e.g. `/tmp`).
**Acceptance**:
- `tools/quick_check.sh` passes in restricted environments.

### P0.1 Add wrapper self-check mode (DONE 2026-02-18)
**Why**: quickly validate environment and config before real runs.
**Scope**:
- New `linux-maint self-check` that validates config readability, writable paths, and basic deps.
- Outputs a single JSON report when `--json` is used.
**Acceptance**:
- Test coverage for both text and JSON output.

### P0.2 Improve monitor runtime accuracy (DONE 2026-02-18)
**Why**: current runtime measurement wraps the whole script; slow subprocesses are not distinguished.
**Scope**:
- Add optional per-subcommand timing with a helper (`lm_time`) to emit `RUNTIME_STEP` lines.
**Acceptance**:
- Backward compatible; no changes to existing RUNTIME lines.

---

## P1 — Operator UX / documentation

### P1.3 Add remediation notes for top WARN/SKIP reasons (DONE 2026-02-19)
**Why**: reduce operator guesswork when common warnings appear.
**Scope**:
- Add brief guidance for `log_spike_warn`, `missing_optional_cmd` (NTP), and `summary_*_failed`.
**Acceptance**:
- Docs include a concise table with reason → action.

### P1.1 Add a “common fixes” section to README (DONE 2026-02-18)
**Why**: reduce time-to-resolution for frequent warnings.
**Scope**:
- Map 5–7 common `reason=` tokens to concrete remediation steps.
**Acceptance**:
- README contains a concise table or list.

### P1.2 Add a “day-2 operations” page (DONE 2026-02-18)
**Why**: operators need guidance for routine upkeep and tuning.
**Scope**:
- New `docs/DAY2.md` with patching flow, baseline refresh, and runtime warn tuning.
**Acceptance**:
- Linked from `docs/README.md`.

---

## P2 — Security / hardening

### P2.3 Harden localhost execution in `lm_ssh` (DONE 2026-02-19)
**Why**: current `bash -lc "… $*"` can re-parse arguments and risks unintended shell expansion.
**Scope**:
- Use a safer exec path for localhost (e.g., pass argv directly or escape safely).
**Acceptance**:
- Tests demonstrate arguments are preserved and no shell injection occurs.

### P2.1 Add SSH command allowlist for remote runs (DONE 2026-02-18)
**Why**: reduce blast radius for remote execution.
**Scope**:
- Optional `LM_SSH_ALLOWLIST` for commands invoked through `lm_ssh`.
**Acceptance**:
- Tests cover allow/deny behavior.

### P2.2 Add optional integrity stamp for summary artifacts (DONE 2026-02-18)
**Why**: tamper-evidence for summary logs shipped off-host.
**Scope**:
- Generate a SHA256 for summary log and JSON (stored alongside in `.sha256`).
**Acceptance**:
- Tests verify checksums are written and match.

---

## P3 — Observability / integrations

### P3.3 Add log retention/rotation guidance and defaults (DONE 2026-02-19)
**Why**: `/var/log/health` can grow unbounded on long-running systems.
**Scope**:
- Provide a sample logrotate config and mention in docs.
**Acceptance**:
- Docs show recommended retention and location.

### P3.1 Add structured JSON log output mode (DONE 2026-02-18)
**Why**: simplify ingestion into SIEM/ELK.
**Scope**:
- `LM_LOG_FORMAT=json` to emit one JSON object per log line.
**Acceptance**:
- Disabled by default; tests validate output shape when enabled.

### P3.2 Add OpenMetrics compatibility for Prometheus output (DONE 2026-02-18)
**Why**: improve compatibility with stricter collectors.
**Scope**:
- Optional `LM_PROM_FORMAT=openmetrics` (adds `# EOF` and proper formatting).
**Acceptance**:
- Test ensures output includes required markers.

---

## P4 — DX / release polish

### P4.3 Add Makefile target for release tarball (DONE 2026-02-19)
**Why**: avoid confusion around `make make-tarball`.
**Scope**:
- Add a `make-tarball` target that calls `tools/make_tarball.sh`.
**Acceptance**:
- `make make-tarball` works with a clean tree.

### P4.1 Add a “breaking changes” checklist (DONE 2026-02-18)
**Why**: enforce contract stability.
**Scope**:
- Extend `docs/RELEASE_CHECKLIST.md` with a breaking-change audit.
**Acceptance**:
- Checklist references JSON schemas and summary contract.

### P4.2 Add repo rename compatibility notes (DONE 2026-02-18)
**Why**: users updating from older name need a clean path.
**Scope**:
- Add a short note to README + docs on the old repo name.
**Acceptance**:
- Both README and docs/README mention the previous `linux_Maint_Scripts` name.
